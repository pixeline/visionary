<h1>Tests</h1>

<table class="pure-table pure-table-horizontal tablesorter">
    <thead>
        <tr>
            <th>#</th>
            <th>Name</th>
            <th>Result</th>
            <th>Ratio</th>
            <th>Finished</th>
            <th>Trials</th>
            <th>Age</th>
            <th>Gender</th>
            <th>Last login</th>
            <th>Vetted</th>
            <th>Voir</th>
        </tr>
    </thead>
    <tbody>

    <repeat group="{{ @tests }}" value="{{ @test }}" counter="{{ @key }}">
        <tr class="{{ @key%2 ? '' : 'pure-table-odd'}}" id="{{ @test->id }}">
            <td>{{ @key }}</td>
            <td>{{ @test->username }}</td>
            <td>{{ @test->diag_result }}</td>
            <td>{{ @test->diag_ratio }}</td>
            <td>{{ @test->finished ? "finished" : "unfinished" }}</td>
            <td>{{ @distinct_users_trials[@test->users_id]["test_count"] }}</td>
            <td>{{ date("Y") - @test->birth_date }}</td>
            <td>{{ @test->gender == "M" ? "Homme":"Femme" }}</td>
            <td>{{ @test->last_login }}</td>
            <td>{{ @test->vetted ? "Invited" : "Normal" }}</td>
            <td><a href="/admin/test/{{ @$test->unique_url }}">Voir</a></td>
        </tr>
    </repeat>

       
    </tbody>
</table>

<style>
    #info {
        position: absolute;
        left: 20px;
        border-radius: 4px;
        background: #fff;
        box-shadow: 2px 4px 10px rgba(0,0,0, 0.4);
        border:1px solid rgba(0,0,0, 0.4);
        padding: 10px;
        font-size: 12px;
    }

    #info:after {
        content: "";
        position: absolute;
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 6px 0 6px 10px;
        border-color: transparent transparent transparent rgba(0, 0, 0, 0.8);
        top: calc(50% - 6px);
        left: 100%;
    }

</style>

<div id="info"></div>

<script src="/assets/js/jquery-1.12.0.min.js"></script>
<script src="/assets/js/jquery.tablesorter.js"></script>
<script type="text/javascript">

    var testData = {{json_encode(@tests)}};

    $(function() {
        $("table").tablesorter({debug: false});

        var $info = $("#info");

        $("tbody tr").on("mouseover", function(){
            $info.show();
           var id = $(this).attr("id");
           var offset = $( this ).offset();

            var info = testData.filter(function(test){
                if(test.id == id){
                    return true;
                }
            });
            var data = info[0];
            var html = "";

            //html += "<div>birth_date : "+data.birth_date+"</div>";
            //html += "<div>diag_ratio : "+data.diag_ratio+"</div>";
            //html += "<div>diag_result : "+data.diag_result+"</div>";
            
            //html += "<div>finished : "+data.finished+"</div>";
           // html += "<div>gender : "+data.gender+"</div>";
            //html += "<div>id : "+data.id+"</div>";
            //html += "<div>last_login : "+data.last_login+"</div>";
            html += "<div>interface : "+data.name+"</div>";
            //html += "<div>unique_url : "+data.unique_url+"</div>";
            html += "<div>username : "+data.username+"</div>";
            html += "<div>email : <a href='mailto:"+data.email+"' target='_blank'> "+data.email+"</a></div>";
            html += "<div>Temps : "+data.test_duration+"</div>";
            //html += "<div>users_id : "+data.users_id+"</div>";
            html += "<div>Teste : <a href='/admin/test/"+data.unique_url+"' target='_blank'>Lien vers le test</a></div>";
            //html += "<div>vetted : "+data.vetted+"</div>";

            $info.css({
                "top" : (offset.top - $info.height()/2 )+"px"
            }).html(html);
        })

        $("tbody tr").on("mouseout", function(){
            $info.hide();
        })
    });

    
</script>

